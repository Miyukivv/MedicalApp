<!doctype html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aplikacja medyczna - strona g≈Ç√≥wna</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<header class="topbar">
    <div class="container topbar__inner">
        <a class="brand" th:href="@{/home}">
            <img class="brand__logo" th:src="@{/img/logo.jpg}" alt="YourMed" />
        </a>


        <div class="topbar__greeting">
            Witaj <span th:text="${welcomeName}">Imiƒô</span>, zdrowego dnia!
        </div>

        <nav class="nav">
            <a class="nav__link nav__link--active" th:href="@{/home}">Strona g≈Ç√≥wna</a>
            <a class="nav__link" th:href="@{/profile}">Profil</a>
            <a class="nav__link" th:href="@{/status}">Status &amp; przeglƒÖd</a>
            <a class="nav__link" th:href="@{/medications}">ZarzƒÖdzanie lekami</a>
            <a class="nav__link" th:href="@{/doctor}" sec:authorize="hasRole('DOCTOR')">Dla lekarza</a>
        </nav>

        <div class="user-menu">
            <button class="user-menu__btn" type="button" aria-haspopup="true" aria-expanded="false">
                <span class="user-menu__label">Ustawienia</span>
                <span class="user-menu__icon" aria-hidden="true">‚öôÔ∏è</span>
            </button>

            <div class="user-menu__dropdown" role="menu" aria-label="Ustawienia konta">
                <form th:action="@{/logout}" method="post" class="user-menu__logout">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="user-menu__item user-menu__item--danger user-menu__btnlink">
                        Wyloguj siƒô
                    </button>
                </form>
            </div>
        </div>

    </div>
</header>

<main>

    <!-- HERO -->
    <section class="hero">
        <div class="hero__bg">
            <div class="hero__overlay"></div>
        </div>

        <div class="container hero__content">
            <div class="hero__left">
                <h1>Automatycznie wspieraj<br />zdrowie ka≈ºdego dnia</h1>
                <p class="hero__subtitle">
                    Ty zadbaj o przyjmowanie lek√≥w, a pamiƒôƒá o nich zostaw nam.
                </p>

                <form class="search" th:action="@{/medicationsInfo}" method="get" autocomplete="off">
                    <span class="search__icon" aria-hidden="true">üîé</span>

                    <div class="search__field">
                        <input
                                id="medicineSearch"
                                name="name"
                                class="search__input"
                                type="text"
                                placeholder="sprawd≈∫ czy lek istnieje"
                                aria-label="Wyszukaj lek"
                                aria-autocomplete="list"
                                aria-controls="medicineSuggest"
                                aria-expanded="false"
                        />

                        <!-- dropdown z sugestiami -->
                        <div id="medicineSuggest" class="search__suggest" role="listbox" aria-label="Sugestie lek√≥w"></div>
                    </div>

                    <button class="search__btn" type="submit" disabled aria-disabled="true">Szukaj leku</button>
                </form>

                <script>
                    (() => {
                        const input = document.getElementById('medicineSearch');
                        const box = document.getElementById('medicineSuggest');

                        let lastQuery = '';
                        let abortCtrl = null;

                        function closeSuggest() {
                            box.classList.remove('is-open');
                            box.innerHTML = '';
                            input.setAttribute('aria-expanded', 'false');
                        }

                        function openSuggest() {
                            box.classList.add('is-open');
                            input.setAttribute('aria-expanded', 'true');
                        }

                        function escapeHtml(s) {
                            return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
                        }

                        async function loadSuggestions(q) {
                            if (abortCtrl) abortCtrl.abort();
                            abortCtrl = new AbortController();

                            const resp = await fetch(`/api/medicines/suggest?q=${encodeURIComponent(q)}&limit=50`, {
                                signal: abortCtrl.signal
                            });

                            if (!resp.ok) return [];
                            return await resp.json();
                        }

                        function render(list, q) {
                            if (!list || list.length === 0) {
                                box.innerHTML = `<div class="search__suggestEmpty">Brak pasujƒÖcych lek√≥w</div>`;
                                openSuggest();
                                return;
                            }

                            const items = list.map(name => {
                                // opcjonalnie: proste pogrubienie dopasowania na poczƒÖtku
                                const safe = escapeHtml(name);
                                const safeQ = escapeHtml(q);
                                const html = safe.toLowerCase().startsWith(q.toLowerCase())
                                    ? `<strong>${safe.slice(0, q.length)}</strong>${safe.slice(q.length)}`
                                    : safe;

                                return `<button type="button" class="search__suggestItem" role="option" data-value="${safe}">
                <span class="search__suggestText">${html}</span>
              </button>`;
                            }).join('');

                            box.innerHTML = items;
                            openSuggest();
                        }

                        input.addEventListener('input', async () => {
                            const q = input.value.trim();
                            if (q.length < 1) {
                                closeSuggest();
                                return;
                            }
                            if (q === lastQuery) return;
                            lastQuery = q;

                            try {
                                const list = await loadSuggestions(q);
                                render(list, q);
                            } catch (e) {
                                // abort jest normalny podczas szybkiego pisania
                                if (e.name !== 'AbortError') closeSuggest();
                            }
                        });

                        // klik na sugestiƒô
                        box.addEventListener('click', (e) => {
                            const btn = e.target.closest('.search__suggestItem');
                            if (!btn) return;
                            input.value = btn.getAttribute('data-value') || '';
                            closeSuggest();
                            input.focus();
                        });

                        // ESC zamyka listƒô
                        input.addEventListener('keydown', (e) => {
                            if (e.key === 'Escape') closeSuggest();
                        });

                        // klik poza polem zamyka listƒô
                        document.addEventListener('click', (e) => {
                            if (!e.target.closest('.search')) closeSuggest();
                        });
                    })();
                </script>

                <!-- opcjonalny watermark "Pomocno≈õƒá" -->
                <div class="hero__bgText">Polska jako≈õƒá</div>
            </div>

            <div class="hero__right">
                <!-- Mr Bean / postaƒá -->
<!--                <img class="hero__character" src="/img/doctor.jpg" alt="Postaƒá (doctor)" />-->
                <img class="hero__character" src="/img/doktorki.svg" alt="doktorki" />
            </div>
        </div>
    </section>

    <!-- BENEFITY -->
    <section class="benefits">
        <div class="container">
            <div class="section-title">
                <h2>Benefity</h2>
                <div class="section-title__bars">
                    <span class="bar bar--blue"></span>
                    <span class="bar bar--mint"></span>
                </div>
            </div>

            <!-- Benefit 1 -->
            <div class="feature">
                <div class="feature__text">
                    <h3>Twoje leki i przypomnienia<br />w jednym miejscu</h3>
                    <ul>
                        <li>Dodawaj leki wraz z dawkowaniem</li>
                        <li>Otrzymuj przypomnienia przed ka≈ºdƒÖ dawkƒÖ</li>
                        <li>Oznaczaj leki jako przyjƒôte i ≈õled≈∫ historiƒô</li>
                    </ul>

                    <a class="btn btn--outline btn--mint" th:href="@{/medications}">Otw√≥rz panel pacjenta ‚Üí</a>
                </div>

                <div class="feature__media">
                    <!-- Ilustracja kalendarz / tablet -->
                    <img class="img-placeholder" src="/img/kalendarz.svg" alt="Ilustracja (kalendarz)" />
                </div>
            </div>

            <!-- Benefit 2 -->
            <div class="feature feature--reverse">
                <div class="feature__text">
                    <h3>ZarzƒÖdzaj swoim leczeniem</h3>
                    <ul>
                        <li>Monitoruj nadchodzƒÖce dawki</li>
                        <li>Aktywuj lub wy≈ÇƒÖcz przypomnienia</li>
                        <li>Otrzymuj powiadomienia e-mail</li>
                        <li>PrzeglƒÖdaj szczeg√≥≈Çy terapii</li>
                    </ul>

                    <a class="btn btn--outline btn--mint" th:href="@{/status}">Przejd≈∫ do harmonogramu ‚Üí</a>
                </div>

                <div class="feature__media">
                    <!-- Ilustracja telefon + notatki -->
                    <img class="img-placeholder" src="/img/megafon.svg" alt="Ilustracja (telefon)" />
                </div>
            </div>

            <!-- Benefit 3 -->
            <div class="feature">
                <div class="feature__text feature__text--dark">
                    <h3>ZarzƒÖdzaj swoim kontem</h3>
                    <ul>
                        <li>Uzupe≈Çnij dane medyczne</li>
                        <li>Dodaj informacje o swoich lekach</li>
                        <li>PowiƒÖ≈º profil z lekarzem</li>
                        <li>Aktywuj powiadomienia e-mail</li>
                    </ul>

                    <a class="btn btn--outline btn--purple" th:href="@{/profile}">Przejd≈∫ do ustawie≈Ñ profilu ‚Üí</a>
                </div>

                <div class="feature__media">
                    <!-- Ilustracja zƒôbatki -->
                    <img class="img-placeholder" src="/img/trybiki.svg" alt="Ilustracja (ustawienia)" />
                </div>
            </div>

            <!-- Opinie -->
            <div class="testimonials">
                <div class="testimonials__media">
                    <!-- obrazek rozmowy -->
                    <img class="img-placeholder" src="/img/rozmowa.svg" alt="Ilustracja (rozmowa)" />
                </div>

                <div class="testimonials__text">
                    <div class="section-title section-title--left">
                        <h2>Co m√≥wiƒÖ nasi klienci?</h2>
                        <div class="section-title__bars">
                            <span class="bar bar--blue"></span>
                            <span class="bar bar--mint"></span>
                        </div>
                    </div>

                    <p class="quote">
                        ‚ÄûSystem przypomnie≈Ñ pom√≥g≈Ç mi regularnie przyjmowaƒá leki. W ko≈Ñcu nie pomijam dawek.‚Äù
                    </p>
                    <p class="quote-author">- Anna K.</p>

                    <p class="quote">
                        ‚ÄûJako lekarz mogƒô ustawiaƒá harmonogramy pacjentom - ogromne u≈Çatwienie.‚Äù
                    </p>
                    <p class="quote-author">- Dr Marcin J.</p>
                </div>
            </div>

        </div>
    </section>

</main>

<footer class="footer">
    <div class="container footer__top">
        <div class="newsletter">
            <h3>Zapisz siƒô do naszego Newslettera</h3>
            <p>
                Poznaj nowo≈õci w dziedzinie medycyny i dowiedz siƒô, jak czƒôsto aktualizujemy naszƒÖ bazƒô zamiennik√≥w lek√≥w.
            </p>
        </div>

        <div class="newsletter-form">
            <label class="newsletter-form__label">Tw√≥j Email</label>
            <div class="newsletter-form__row">
                <input class="newsletter-form__input" type="email" placeholder="example@email.com" />
                <button class="newsletter-form__btn" type="button">Subskrybuj</button>
            </div>
        </div>
    </div>

    <div class="container footer__bottom">
        <div class="footer__col">
            <img class="brand__logo" th:src="@{/img/logo.jpg}" alt="YourMed" />
            <p>
                Twoja ulubiona aplikacja wspomagajƒÖca kompleksowe dbanie o Twoje zdrowie.
                Wygodnie, szybko i bez stresu.
            </p>
        </div>

        <div class="footer__col">
            <h4>O nas</h4>
            <a href="#">Kontakt</a>
            <a href="#">Kim jeste≈õmy</a>
            <a href="#">Regulamin</a>
        </div>

        <div class="footer__col">
            <h4>Us≈Çugi</h4>
            <a href="#">Wsp√≥≈Çpraca</a>
            <a href="#">Baza lek√≥w</a>
            <a href="#">Zapytaj o lek</a>
        </div>

        <div class="footer__col">
            <h4>Media Spo≈Çeczno≈õciowe</h4>
            <a href="#">Facebook</a>
            <a href="#">Twitter</a>
            <a href="#">LinkedIn</a>
        </div>
    </div>
</footer>

</body>
</html>
